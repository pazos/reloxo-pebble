<!DOCTYPE html>
<html>
  <head>
  <title>reloxo en galego</title>
  <link rel='stylesheet' type='text/css' href='css/slate.min.css'>
  <script src='js/slate.min.js'></script>
  <style>
  .title {
    padding: 15px 10px;
    text-transform: uppercase;
    font-family: 'PT Sans', sans-serif;
    font-size: 1.2em;
    font-weight: 500;
    color: #888888;
    text-align: center;
  }
  </style>
  </head>

  <body>
    <h1 class='title'>configuracion do reloxo</h1>
    <div class='item-container'>
      <div class='item-container-header'>elementos da interface</div>
      <div class='item-container-content'>
        <label class='item'>
          dia da semana
          <input id='check_dia' type='checkbox' class='item-toggle' checked>
        </label>
        <label class='item'>
          dia do mes
          <input id='check_data' type='checkbox' class='item-toggle' checked>
        </label>
        <label class='item'>
          carga da bateria 
          <input id='check_carga' type='checkbox' class='item-toggle' checked>
        </label>
      </div>
      <div class='item-container-footer'>
        Elixe a informacion que queres visualizar no teu reloxo
      </div>
    </div>

    <div class='item-container'>
      <div class='item-container-header'>cores da interface</div>
      <div class='item-container-content'>
        <label class='item'>
          invertir cores
          <input id='check_invertir' type='checkbox' class='item-toggle'>
        </label>
      </div>
      <div class='item-container-footer'>
        invirte a cor de fondo e do texto
      </div>
    </div>

    <div class='item-container'>
      <div class='button-container'>
        <input id='save_button' type='button' class='item-button' value='GARDAR AXUSTES'>
      </div>
    </div>
  </body>
  <script>
      function persistWrite(key, value) {
        localStorage.setItem(key, value);
      }
      
      var persistRead = function(key, defaultValue) {
        if(localStorage.getItem(key) === null) {
          return defaultValue;
        } else {
          return localStorage.getItem(key);
        }
      };

      function firstTimeSetup() {
        if(!persistRead('first-time', false)) {
          persistWrite('first-time', true);
          persistWrite('dia', 'true');
          persistWrite('data', 'true');
          persistWrite('carga', 'true');
          persistWrite('invertir', 'false');
        }
      }

      function loadConfig() {
        document.getElementById('check_dia').checked = persistRead('dia', 'false') === 'true';
        document.getElementById('check_data').checked = persistRead('data', 'false') === 'true';
        document.getElementById('check_carga').checked = persistRead('carga', 'false') === 'true';
        document.getElementById('check_invertir').checked = persistRead('invertir', 'false') === 'true';
      }

      function ajax(url, type, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
          callback(this.responseText);
        };
        xhr.open(type, url);
        xhr.send();
      };

      var submitButton = document.getElementById('save_button');
      submitButton.addEventListener('click', function() {
          var options = {
            'dia': document.getElementById('check_dia').checked ? 'true' : 'false',
            'data': document.getElementById('check_data').checked ? 'true' : 'false',
            'carga': document.getElementById('check_carga').checked ? 'true' : 'false',
            'invertir': document.getElementById('check_invertir').checked ? 'true' : 'false',

          };  
          var location = 'pebblejs://close#' + encodeURIComponent(JSON.stringify(options));
          persistWrite('dia', options.dia);
          persistWrite('data', options.data);
          persistWrite('carga', options.carga);
          persistWrite('invertir', options.invertir);
          document.location = location;
        }, 
      false);
      firstTimeSetup();
      loadConfig();
  </script>
</html>